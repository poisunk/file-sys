# File-Sys：Rust实现的文件系统模拟器

## 项目概述

File-Sys是一个用Rust语言实现的文件系统模拟器，旨在模拟操作系统中文件系统的基本功能和结构。该项目实现了一个简单但功能完整的文件系统，包括文件和目录的创建、读写、删除等基本操作，以及底层的存储管理机制。

## 架构设计

项目采用模块化设计，主要包含以下核心组件：

### 核心模块 (core)

- **硬件模拟 (`hardware.rs`)**：模拟底层存储硬件，提供基本的数据块读写功能
  - 定义了块大小（4096字节）和总块数（64块）
  - 提供数据的加载和保存功能

- **索引节点 (`inode.rs`)**：管理文件和目录的元数据
  - 存储文件/目录名称、大小和数据块位置
  - 提供序列化和反序列化功能

- **文件系统 (`fs.rs`)**：实现文件系统的核心逻辑
  - 管理索引节点和数据块的分配和释放
  - 提供文件和目录操作的高级接口
  - 实现超级块的加载和保存

- **目录 (`dir.rs`)**：实现目录结构和操作
  - 管理目录项（文件和子目录）
  - 提供目录内容的显示和修改功能

- **文件 (`file.rs`)**：实现文件结构和操作
  - 管理文件内容和属性
  - 提供文件内容的读写功能

### 硬件模拟

- **块大小**：4096字节
- **总块数**：64块
- **总存储容量**：256KB

### 索引节点 (Inode)

- **大小**：64字节
- **结构**：
  - 名称（字符串）
  - 大小（u32）
  - 数据块位置（Vec<u32>）

### 目录项 (DirItem)

- **结构**：
  - 索引节点位置（u32）
  - 名称（字符串）
  - 类型（"file"或"dir"）
  - 大小（u32）

## 功能

### 文件操作

- **创建文件**：`create <文件名>`
- **打开文件**：`open <文件名>`
- **写入文件**：`write <文件名> <内容>`
- **删除文件**：`rm <文件名>`

### 目录操作

- **显示目录内容**：`ls`
- **创建目录**：`mkdir <目录名>`
- **进入目录**：`cd <目录名>`
- **删除目录**：`rmdir <目录名>`

### 系统操作

- **退出系统**：`exit`

## 使用方法

### 编译和运行

```bash
# 克隆项目
git clone <项目地址>
cd file-sys

# 编译项目
cargo build --release

# 运行项目
cargo run --release
```

### 命令示例

```
/> mkdir documents
/> cd documents
documents> create hello.txt
documents> write hello.txt Hello, World!
documents> open hello.txt
Hello, World!
documents> mkdir subfolder
documents> cd subfolder
subfolder> cd ..
documents> ls
. (dir)
.. (dir)
hello.txt (file) 13B
subfolder (dir)
documents> rm hello.txt
documents> cd /
/> rmdir documents
/> exit
```

## 项目限制

- 文件大小限制：由于索引节点设计，单个文件最多只能使用7个数据块
- 不支持文件权限和多用户
- 不支持符号链接和硬链接
- 不支持文件和目录的重命名操作

## 未来改进

- 增加文件和目录的权限控制
- 支持更大的文件（通过间接索引块）
- 添加文件和目录的重命名功能
- 实现更多的文件系统功能（如链接、挂载等）
- 优化存储效率和访问速度